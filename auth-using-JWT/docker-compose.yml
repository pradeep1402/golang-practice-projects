version: "3.8" # ğŸ§¾ Compose file format version

services: # ğŸ§± Services to run â€” each is like a mini computer
  postgres: # ğŸ‘¨â€ğŸ”§ Name of the service (you can call it anything)
    image: postgres:15 # ğŸ“¦ Download the official PostgreSQL version 15
    container_name: auth-postgres # ğŸ·ï¸ Name the container (for reference)
    restart: always # ğŸ”„ Restart if it crashes
    environment: # ğŸŒ Set up environment variables for the DB
      POSTGRES_USER: postgres # Username = postgres
      POSTGRES_PASSWORD: secret # Password = secret
      POSTGRES_DB: authdb # Database = bookstore
    ports: # ğŸŒ Expose the container's port to your machine
      - "5432:5432" # containerPort:hostPort
    volumes: # ğŸ’¾ Persist data so DB isn't lost when restarting
      - pg_data:/var/lib/postgresql/data

  auth:
    build: .
    container_name: grpc-auth
    restart: always
    depends_on:
      - postgres
    environment:
      - DATABASE_URL=postgres://postgres:secret@postgres:5432/authdb?sslmode=disable
    ports:
      - "50051:50051"

volumes: # ğŸ”’ Declare volume to persist database storage
  pg_data:
